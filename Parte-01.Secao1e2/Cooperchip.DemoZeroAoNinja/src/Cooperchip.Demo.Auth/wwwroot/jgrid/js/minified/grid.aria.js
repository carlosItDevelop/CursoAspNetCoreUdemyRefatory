!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(v){"use strict";v.extend(v.jgrid,{focusableElementsList:[">a[href]",">button:not([disabled])",">area[href]",">input:not([disabled])",">select:not([disabled])",">textarea:not([disabled])",">iframe",">object",">embed",">*[tabindex]",">*[contenteditable]"]}),v.jgrid.extend({ariaBodyGrid:function(e){var f=v.extend({onEnterCell:null,onKeyCheck:null,customCellAction:null},e||{});return this.each(function(){var a=this,t=v.jgrid.getMethod("getStyleUI"),l=t(a.p.styleUI+".common","highlight",!0);function n(e,i){return!isNaN(e)&&!isNaN(i)&&0<=e&&0<=i&&a.rows.length&&e<a.rows.length&&i<a.p.colModel.length}function r(e,i){var t,i=a.p.iRow+i,r=a.p.iCol+e,o=a.rows.length,e=0!==e;return!!o&&(t=a.p.colModel.length,e&&(r<0&&2<=i&&(r=t-1,i--),t<=r)&&(r=0,i++),e||(i<1?(r--,a.rows[i=o-1]&&0<=r&&!a.rows[i].cells[r]&&i--):(o<=i||!a.rows[i].cells[r])&&(i=1,r++)),n(i,r)?{row:i,col:r}:!!n(a.p.iRow,a.p.iCol)&&{row:a.p.iRow,col:a.p.iCol})}function o(e,i){var t=r(e,i);if(!t)return!1;for(;v(a.rows[t.row].cells[t.col]).is(":hidden");)if(a.p.iRow=t.row,a.p.iCol=t.col,t=r(e,i),a.p.iRow===t.row&&a.p.iCol===t.col)return!1;return 0!==i&&v(a).jqGrid("setSelection",a.rows[t.row].id,!1,null,!1),t}function d(e){var i=a.p.page,t=a.p.lastpage;a.p.page!==(i=t<(i=(i+=e)<=0?1:i)?t:i)&&(a.p.page=i,a.grid.populate())}var i=v.jgrid.focusableElementsList.join();v(a).removeAttr("tabindex"),v(a).on("jqGridAfterGridComplete.setAriaGrid",function(e){v("tbody",a).first().find(">tr:not(.jqgfirstrow)>td:not(:hidden, :has("+i+"))").attr("tabindex",-1),v("tbody",a).first().find(">tr:not(.jqgfirstrow)").removeAttr("tabindex"),void 0!==a.p.iRow&&void 0!==a.p.iCol&&a.rows[a.p.iRow]&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",0).focus(function(){v(this).addClass(l)}).blur(function(){v(this).removeClass(l)})}),a.p.iRow=1,a.p.iCol=v.jgrid.getFirstVisibleCol(a);var s=0,c=0,p=!!v.jgrid.isFunction(f.customCellAction)&&f.customCellAction,u=!!v.jgrid.isFunction(f.onKeyCheck)&&f.onKeyCheck;v(a).on("keydown",function(e){if((!a.p.navigationDisabled||!0!==a.p.navigationDisabled)&&!e.target.id.startsWith("jqs_"+a.p.id)&&(!u||u.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e))){var i;switch(e.which||e.keyCode){case 38:i=o(0,-1),s=i.row,c=i.col,e.preventDefault();break;case 40:i=o(0,1),s=i.row,c=i.col,e.preventDefault();break;case 37:i=o(-1,0),s=i.row,c=i.col,e.preventDefault();break;case 39:i=o(1,0),s=i.row,c=i.col,e.preventDefault();break;case 36:s=e.ctrlKey?1:a.p.iRow,c=0,e.preventDefault();break;case 35:s=e.ctrlKey?a.rows.length-1:a.p.iRow,c=a.p.colModel.length-1,e.preventDefault();break;case 33:d(-1),c=a.p.iCol,s=a.p.iRow,e.preventDefault();break;case 34:d(1),c=a.p.iCol,(s=a.p.iRow)>a.rows.length-1&&(s=a.rows.length-1,a.p.iRow=a.rows.length-1),e.preventDefault();break;case 13:return void(v.jgrid.isFunction(f.onEnterCell)&&(f.onEnterCell.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e),e.preventDefault()));case 113:try{v(a).jqGrid("editCell",a.p.iRow,a.p.iCol,!0,e)}catch(e){}default:return void(p&&p.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e))}v(a).jqGrid("focusBodyCell",s,c,t,l)}}),v(a).on("jqGridBeforeSelectRow.ariaGridClick",function(){return!1}),v(a).on("jqGridCellSelect.ariaGridClick",function(e,i,t,r,o){var n,o=o.target;0<a.p.iRow&&0<=a.p.iCol&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",-1),(v(o).is("td")||v(o).is("th")||o.id.startsWith("jqs_"+a.p.id))&&(a.p.iCol=o.cellIndex,n=v(o).closest("tr.jqgrow"),a.p.iRow=n[0].rowIndex,v(o).attr("tabindex",0).addClass(l).focus().blur(function(){v(this).removeClass(l)}))}),a.p.ariaBody=!0})},excelLikeGrid:function(e){var b=v.extend({beforeDeleteCell:null,customCellAction:null,customUndoFunction:null,specialChars:["~","!","@","#","$","%","^","&","*","(",")","_","+","{","}",":",'"',"|","<",">","?",",",".","/",";","\\","[","]"],addonChars:!1,onKeyCheck:null},e||{});return this.each(function(){var a=this,l=v.jgrid.getMethod("getStyleUI"),d=l(a.p.styleUI+".common","highlight",!0);function n(e,i){return!isNaN(e)&&!isNaN(i)&&0<=e&&0<=i&&a.rows.length&&e<a.rows.length&&i<a.p.colModel.length}function r(e,i){var i=a.p.iRow+i,t=a.p.iCol+e,r=a.rows.length,e=0!==e,o=a.p.frozenColumns?a.p.frozenColCount+1:0;return!!r&&(r=a.p.colModel.length,e&&(t=t<o?o:t)===r&&(t=r),e||a.rows[i]&&0<=t&&!a.rows[i].cells[t]&&i--,n(i,t)?{row:i,col:t}:!!n(a.p.iRow,a.p.iCol)&&{row:a.p.iRow,col:a.p.iCol})}function s(e,i){var t=r(e,i);if(!t)return!1;for(;v(a.rows[t.row].cells[t.col]).is(":hidden");)if(a.p.iRow=t.row,a.p.iCol=t.col,t=r(e,i),a.p.iRow===t.row&&a.p.iCol===t.col)return!1;return 0!==i&&v(a).jqGrid("setSelection",a.rows[t.row].id,!1,null,!1),t}function c(e){var i=a.p.page,t=a.p.lastpage;a.p.page!==(i=t<(i=(i+=e)<=0?1:i)?t:i)&&(a.p.page=i,a.grid.populate())}a.p.F2key=!1;var i=v.jgrid.focusableElementsList.join();v(a).removeAttr("tabindex"),v(a).on("jqGridAfterGridComplete.setAriaGrid",function(e){v("tbody",a).first().find(">tr:not(.jqgfirstrow)>td:not(:hidden, :has("+i+"))").attr("tabindex",-1),v("tbody",a).first().find(">tr:not(.jqgfirstrow)").removeAttr("tabindex"),void 0!==a.p.iRow&&void 0!==a.p.iCol&&a.rows[a.p.iRow]&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",0).focus(function(){v(this).addClass(d)}).blur(function(){v(this).removeClass(d)})}),a.p.iRow=1,a.p.iCol=v.jgrid.getFirstVisibleCol(a),a.p.ariaBody=!0;var p=0,u=0,f=!!v.jgrid.isFunction(b.customCellAction)&&b.customCellAction,h=!!v.jgrid.isFunction(b.beforeDeleteCell)&&b.beforeDeleteCell,w=new Set(b.specialChars),g=!1,C=(a.addEventListener("paste",function(e){g&&(e=(e.clipboardData||window.clipboardData).getData("text"),v(a).jqGrid("saveCell",a.p.iRow,a.p.iCol,e),g=!1)}),!!v.jgrid.isFunction(b.onKeyCheck)&&b.onKeyCheck);v(a).on("keydown",function(e){if((!a.p.navigationDisabled||!0!==a.p.navigationDisabled)&&!e.target.id.startsWith("jqs_"+a.p.id)&&(!C||C.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e))){var i=e.which||e.keyCode,t=e.ctrlKey||17===i;switch(i){case 38:r=s(0,-1),p=r.row,u=r.col,e.preventDefault();break;case 40:case 13:r=s(0,1),p=r.row,u=r.col,e.preventDefault();break;case 37:r=s(-1,0),p=r.row,u=r.col,e.preventDefault();break;case 39:r=s(1,0),p=r.row,u=r.col,e.preventDefault();break;case 36:p=e.ctrlKey?1:a.p.iRow,u=a.p.frozenColumns?a.p.frozenColCount+1:0,e.preventDefault();break;case 35:p=e.ctrlKey?a.rows.length-1:a.p.iRow,u=a.p.colModel.length-1,e.preventDefault();break;case 33:c(-1),u=a.p.iCol,p=a.p.iRow,e.preventDefault();break;case 34:c(1),u=a.p.iCol,(p=a.p.iRow)>a.rows.length-1&&(p=a.rows.length-1,a.p.iRow=a.rows.length-1),e.preventDefault();break;case 9:r=e.shiftKey?s(-1,0):s(1,0),p=r.row,u=r.col,e.preventDefault();break;case 113:try{v(a).jqGrid("editCell",a.p.iRow,a.p.iCol,!0,e,!1),a.p.F2key=!0}catch(e){}break;case 8:case 46:var r=!0;!0===(r=h?h.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e):r)&&v(a).jqGrid("saveCell",a.p.iRow,a.p.iCol,"");break;case 86:if(t)return g=!0;case 90:if(t)return r=!0,(r=v.jgrid.isFunction(b.customUndoFunction)?b.customUndoFunction.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e):r)&&a.p.savedValues&&v(a).jqGrid("getCell",a.rows[a.p.iRow].id,a.p.colModel[a.p.iCol].name,!1)===a.p.savedValues.newvalue&&a.p.iRow===a.p.savedValues.indexRow&&v(a).jqGrid("saveCell",a.p.iRow,a.p.iCol,a.p.savedValues.oldvalue),!0;default:var r=/^[a-z]$/i.test(e.key),o=/^[0-9]$/i.test(e.key),n=!1;return b.addonChars&&(n=b.addonChars.test(e.key)),(r||o||w.has(e.key)||n)&&v(a).jqGrid("editCell",a.p.iRow,a.p.iCol,!0,e,!0),void(f&&f.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e))}v(a).jqGrid("focusBodyCell",p,u,l,d)}}),v(a).on("jqGridBeforeSelectRow.ariaGridClick",function(){return!1}),v(a).on("jqGridCellSelect.ariaGridClick",function(e,i,t,r,o){var n,o=o.target;0<a.p.iRow&&0<=a.p.iCol&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",-1),(v(o).is("td")||v(o).is("th")||o.id.startsWith("jqs_"+a.p.id))&&(a.p.iCol=o.cellIndex,a.p.savedRow.length&&v(a).jqGrid("saveCell",a.p.savedRow[0].id,a.p.savedRow[0].ic),n=v(o).closest("tr.jqgrow"),a.p.iRow=n[0].rowIndex,v(o).attr("tabindex",0).addClass(d).focus().blur(function(){v(this).removeClass(d)}))}).on("jqGridDblClickRow.ariaGridDblClick",function(e,i,t,r,o){v(a).jqGrid("editCell",t,r,!0,o,!1),a.p.F2key=!0})})},focusBodyCell:function(a,l,d,s){return this.each(function(){var e,i=this,t=d||v.jgrid.getMethod("getStyleUI"),r=s||t(i.p.styleUI+".common","highlight",!0),o=v.jgrid.focusableElementsList.join();function n(e){return v(o,e)[0]}void 0!==a&&void 0!==l?!isNaN(i.p.iRow)&&!isNaN(i.p.iCol)&&0<=i.p.iCol&&(e=n(i.rows[i.p.iRow].cells[i.p.iCol]),v(e||i.rows[i.p.iRow].cells[i.p.iCol]).attr("tabindex",-1)):(a=i.p.iRow,l=i.p.iCol),a=parseInt(a,10),l=parseInt(l,10),0<a&&0<=l&&(e=n(i.rows[a].cells[l]),v(e||i.rows[a].cells[l]).attr("tabindex",0).addClass(r).focus().blur(function(){v(this).removeClass(r)}),i.p.iRow=a,i.p.iCol=l)})},resetAriaBody:function(){return this.each(function(){var i=this,t=!1,e=(i.p.ariaBody=!1,v(i).attr("tabindex","0").off("keydown").off("jqGridBeforeSelectRow.ariaGridClick").off("jqGridCellSelect.ariaGridClick").off("jqGridAfterGridComplete.setAriaGrid"),v.jgrid.focusableElementsList.join());v("tbody",i).first().find(">tr:not(.jqgfirstrow)>td:not(:hidden, :has("+e+"))").removeAttr("tabindex").off("focus"),v("tbody",i).first().find(">tr:not(.jqgfirstrow)").attr("tabindex",-1);try{i.removeEventListener("paste",function(e){t&&(e=(e.clipboardData||window.clipboardData).getData("text"),v(i).jqGrid("saveCell",i.p.iRow,i.p.iCol,e),t=!1)},!0)}catch(e){}})},ariaHeaderGrid:function(e){var t=v.extend({onHeaderKeyCheck:null},e||{});return this.each(function(){var o=this,e=v.jgrid.getMethod("getStyleUI")(o.p.styleUI+".common","highlight",!0),i=v("#gbox_"+o.p.id).find(".ui-jqgrid-hbox>table").first(),n=!!v.jgrid.isFunction(t.onHeaderKeyCheck)&&t.onHeaderKeyCheck;v("tr.ui-jqgrid-labels",i).on("keydown",function(e){var i=o.p.selHeadInd,t=e.which||e.keyCode,r=o.grid.headers.length;if(!n||n.call(o,i,e))switch(t){case 37:if(0<=i-1){for(i--;v(o.grid.headers[i].el).is(":hidden")&&0<=i-1&&!(--i<0););0<=i&&(v(o.grid.headers[i].el).focus(),v(o.grid.headers[o.p.selHeadInd].el).attr("tabindex","-1"),o.p.selHeadInd=i,e.preventDefault())}break;case 39:if(i+1<r){for(i++;v(o.grid.headers[i].el).is(":hidden")&&i+1<r&&!(r-1<++i););i<r&&(v(o.grid.headers[i].el).focus(),v(o.grid.headers[o.p.selHeadInd].el).attr("tabindex","-1"),o.p.selHeadInd=i,e.preventDefault())}break;case 13:v(o.grid.headers[i].el).find("div").first().trigger("click"),e.preventDefault();break;default:return}}),v("tr.ui-jqgrid-labels>th:not(:hidden)",i).attr("tabindex",-1).focus(function(){v(this).addClass(e).attr("tabindex","0")}).blur(function(){v(this).removeClass(e)}),o.p.selHeadInd=v.jgrid.getFirstVisibleCol(o),v(o.grid.headers[o.p.selHeadInd].el).attr("tabindex","0")})},focusHeaderCell:function(i){return this.each(function(){var e=this;0<=(i=void 0===i?e.p.selHeadInd:i)&&i<e.p.colModel.length&&(v(e.grid.headers[e.p.selHeadInd].el).attr("tabindex","-1"),v(e.grid.headers[i].el).focus(),e.p.selHeadInd=i)})},resetAriaHeader:function(){return this.each(function(){var e=v("#gbox_"+this.p.id).find(".ui-jqgrid-hbox>table").first();v("tr.ui-jqgrid-labels",e).off("keydown"),v("tr.ui-jqgrid-labels>th:not(:hidden)",e).removeAttr("tabindex").off("focus blur")})},ariaPagerGrid:function(){return this.each(function(){var r=this,e=v.jgrid.getMethod("getStyleUI"),i=e(r.p.styleUI+".common","highlight",!0),o="."+e(r.p.styleUI+".common","disabled",!0),n=v(".ui-pg-button",r.p.pager),a=n.length;n.attr("tabindex","-1").focus(function(){v(this).addClass(i)}).blur(function(){v(this).removeClass(i)}),r.p.navIndex=0,setTimeout(function(){var e=n.not(o).first().attr("tabindex","0");r.p.navIndex=e[0]&&e[0].cellIndex?e[0].cellIndex-1:0},100),v(r.p.pager).find("table.ui-pager-table tr").first().on("keydown",function(e){var i=e.which||e.keyCode,t=r.p.navIndex;switch(i){case 37:if(0<=t-1){for(t--;v(n[t]).is(o)&&0<=t-1&&!(--t<0););0<=t&&(v(n[r.p.navIndex]).attr("tabindex","-1"),v(n[t]).attr("tabindex","0").focus(),r.p.navIndex=t),e.preventDefault()}break;case 39:if(t+1<a){for(t++;v(n[t]).is(o)&&t+1<a+1&&!(a-1<++t););t<a&&(v(n[r.p.navIndex]).attr("tabindex","-1"),v(n[t]).attr("tabindex","0").focus(),r.p.navIndex=t),e.preventDefault()}break;case 13:v(n[t]).trigger("click"),e.preventDefault();break;default:return}})})},focusPagerCell:function(t){return this.each(function(){var e=v(".ui-pg-button",this.p.pager),i=e.length;0<=(t=void 0===t?this.p.navIndex:t)&&t<i&&(v(e[this.p.navIndex]).attr("tabindex","-1"),v(e[t]).attr("tabindex","0").focus(),this.p.navIndex=t)})},resetAriaPager:function(){return this.each(function(){v(".ui-pg-button",this.p.pager).removeAttr("tabindex").off("focus"),v(this.p.pager).find("table.ui-pager-table tr").first().off("keydown")})},setAriaGrid:function(e){var i=v.extend({header:!0,body:!0,pager:!0,onEnterCell:null,customCellAction:null,excel:!1},e||{});return this.each(function(){i.header&&v(this).jqGrid("ariaHeaderGrid",i),i.body&&(i.excel?v(this).jqGrid("excelLikeGrid",i):v(this).jqGrid("ariaBodyGrid",i)),i.pager&&v(this).jqGrid("ariaPagerGrid")})},resetAriaGrid:function(e){var i=v.extend({header:!0,body:!0,pager:!0},e||{});return this.each(function(){i.body&&v(this).jqGrid("resetAriaBody"),i.header&&v(this).jqGrid("resetAriaHeader"),i.pager&&v(this).jqGrid("resetAriaPager")})}})});